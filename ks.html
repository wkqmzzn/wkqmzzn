<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学习系统</title>
    <style type="text/css">
        body {
            background: #FEFA83;
            margin: auto;
        }

        div.border {
            width: 70%;
            height: 70%;
            min-height: 500px;
            border: 5px solid #000;
            position: relative;
            top: 50px;
            left: 15%;
            box-shadow: 6px 8px 6px 6px rgba(0, 0, 0, 0.5);
            border-radius: 10px;
        }

        div.clientwidth {
            height: 20px;
            width: 20px;
            position: absolute;
            right: 80px;
            top: 90%;
            border: 3px solid black;
            border-radius: 5px;
        }

        div.buttons {
            position: absolute;
            top: 0px;
            left: 33%;
            height: 50%;
            width: 40%;
        }

        input.play {
            width: 25%;
            height: 55px;
            border-radius: 40px 40px 80px 80px;
            background-color: #B4FDFF;
            border: 3px solid black;
            font-size: 2em;
            position: absolute;
            top: 0px;
            left: 30%;
            cursor: pointer;
        }

        input.pre, input.next {
            width: 20%;
            height: 49px;
            border: 3px solid black;
            font-size: 1em;
            position: absolute;
            top: 0px;
            cursor: pointer;
        }

        input.pre {
            border-radius: 150px 0 0 150px;
            background-color: #CCF783;
            left: 10px;
        }

        input.next {
            border-radius: 0 150px 150px 0;
            background-color: #CCF783;
            left: 63%;
        }

        input.pause {
            width: 15%;
            height: 30px;
            border-radius: 40px;
            background-color: #CCF783;
            border: 3px solid black;
            font-size: 1em;
            position: absolute;
            top: 60px;
            left: 35%;
            cursor: pointer;
        }

        input.qh {
            width: 15%;
            height: 80px;
            border-radius: 150px;
            background-color: #B4FDFF;
            border: 3px solid black;
            font-size: 1em;
            position: absolute;
            top: 100px;
            left: 35%;
            cursor: pointer;
        }

        .num1, .num2 {
            width: 20%;
            height: 70px;
            border: 1px solid black;
            position: absolute;
            top: 80px;
            background-color: white;
        }

        .num2 {
            left: 70%;
        }

        div.down {
            position: relative;
            top: 60px;
            left: 0;
            height: 170px;
            width: 100%;
        }

        h1 {
            font-family: 黑体;
            font-size: 6em;
            font-style: italic;
            line-height: 50px;
        }

        div.h1, div.h2 {
            position: absolute;
            height: 150px;
            top: 0;
            z-index: -10;
        }

        div.h1 {
            left: 100px;
        }

        div.h2 {
            right: 100px;
        }

        video#video, audio#audio {
            width: 70%;
            height: 80%;
            position: relative;
            top: 10px;
            left: 10%;
            padding: 40px;
        }

        .num1, .num2 {
            font-size: 1.8vw;
        }

        div#stage p {
            text-align: center;
            background-color: #f5f1b4;
            color: #38495a;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 18px;
            font-weight: bold;
        }

        div#stage p:hover {
            background-color: #2980b9;
        }

        div#header2 {
            position: absolute;
            top: 105px;
            z-index: 5;
            left: 33%;
        }

        #header2  {
            list-style-type: none;
            padding: 0;
            display: flex;
            align-items: center;
        }

        #header2 a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 5px;
            margin:5px;
            background-color: #f2f2f2;
            transition: background-color 0.3s ease;
        }

        #header2 a:hover {
            background-color: #e2e2e2;
        }

        img#img2 {
            z-index: 10;
            position: absolute;
            top: 10%;
            left: 75%;
        }

        footer {
            margin: 80px auto 0;
            display: block;
            width: 100%;
            min-width: 100%;
            height: 320px;
            background-color: #222;
            color: white;
        }

        div#footercontent {
            width: 1120px;
            position: relative;
            margin: 0 auto;
        }

        div#contact {
            width: 100%;
            position: relative;
            float: left;
            margin: 80px auto 30px auto;
            display: block;
        }

        div#copy {
            width: 100%;
            position: relative;
            float: left;
            margin: 0 auto;
            border-top: 1px solid rgba(255, 255, 255, 0.10);
            font-size: 14px;
            line-height: 60px;
            color: rgba(255, 255, 255, 0.30);
            text-align: center;
        }

        div#header {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #333;
            padding: 15px;
        }

        div#header a {
            margin: 0 10px;
            text-decoration: none;
            color: #fff;
        }

        div#header img {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            padding: 10px;
        }
    </style>
</head>
<script src="ks.js" type="text/javascript"></script>
<body>
<div id="header">
</div>

<div id="header2">
    <ul>
    </ul>
</div>
<div class="border" id="stage">
    <video id="video"></video>
    <img width="15%" height="35%" id="img2" src="../新项目/images/0.jpg">
    <audio id="audio"></audio>
    <div id="clientwidth" class="clientwidth">
        <img width="100%" id="img1"></div>
    <div id="zimu"><h3></h3></div>
</div>
<div class="down">
    <div class="h1">
        <h1>study</h1>
    </div>
    <div class="buttons" id="UI">
        <input type="text" class="num1" id="currentTime">
        <input type="button" value="播放" class="play" id="play">
        <input type="button" value="暂停" class="pause" id="stop">
        <input type="button" value="上一个" class="pre" id="pre">
        <input type="button" value="下一个" class="next" id="next">
        <input type="button" value="切换媒体" class="qh" id="switch">
        <input type="text" class="num2" id="logo">
    </div>
    <div class="h2">
        <h1>system</h1>
    </div>
</div>
<footer>
    <div id="footercontent">
        <div id="contact">
            <div style="width:30%; height:140px; position:relative; float:left; background-color:rgba(0,0,0,0.20);">
                <div class="footertitle" style="text-align:center;">学校</div>
                <div class="footertext" style="text-align:center;">江西科技师范大学</div>
            </div>
            <div style="width:30%; height:140px; position:relative; float:left; background-color:rgba(0,0,0,0.40);">
                <div class="footertitle" style="text-align:center;">老师及第四组小组成员</div>
                <div class="footertext" style="text-align:center;">第四组组长/俞嘉美<br> 成员：刘嘉舒 管茂 韩钦生</div>
            </div>
            <div style="width:30%; height:140px; position:relative; float:left; background-color:rgba(0,0,0,0.20);">
                <div class="footertitle" style="text-align:center;">班级</div>
                <div class="footertext" style="text-align:center;">21级java1班</div>
            </div>

        </div>
        <div id="copy">©2023 江西科技师范大学&nbsp;&nbsp;李建宏老师指导</div>
    </div>
</footer>
</body>

<script>
    /*****定义全局变量*****/

        //开启同步代码
    var Model = {};
    Model.i = 0;
    Model.isVideo = true;

    Model.UI = {};
    Model.UI.stageDom = document.getElementById("stage");
    Model.UI.videoDom = document.getElementById("video");
    Model.UI.audioDom = document.getElementById("audio");
    Model.UI.preDom = document.getElementById("pre");
    Model.UI.playDom = document.getElementById("play");
    Model.UI.stopDom = document.getElementById("stop");
    Model.UI.nextDom = document.getElementById("next");
    Model.UI.logoDom = document.getElementById("logo");
    Model.UI.timeDom = document.getElementById("currentTime");
    Model.UI.switchDom = document.getElementById("switch");
    Model.UI.clientDom = document.getElementById("clientwidth");
    Model.UI.borderDom = document.getElementById("border");
    Model.UI.imgDom = document.getElementById("img1");
    Model.UI.zimuDom = document.getElementById("zimu");

    Model.UI.videoDom.videoLength = mediaData.videoFiles.length;
    Model.UI.audioDom.audioLength = mediaData.audioFiles.length;

    Model.UI.videoDom.getURL = function () {
        return mediaData.videoPath + mediaData.videoFiles[Model.i];
    }
    Model.UI.audioDom.getURL = function () {
        return mediaData.audioPath + mediaData.audioFiles[Model.i].fileName;
    }
    Model.createWidth = function () {
        Model.UI.imgDom
            .src = "https://s1.aigei.com/src/img/png/53/53f44cf101ad4befa8d28f3e84a78290.png?imageMogr2/auto-orient/thumbnail/!132x132r/gravity/Center/crop/132x132/quality/85/&e=1735488000&token=P7S2Xpzfz11vAkASLTkfHN7Fw-oOZBecqeJaxypL:a6w7keugJt0euA2_kE-Mh7oonFw";
        Model.UI.imgDom.onclick = function () {
            if (!document.fullscreenElement) {
                Model.UI.videoDom.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
    }
    Model.showMediaNum = function (i) {
        let length = null;
        if (Model.isVideo) {
            length = Model.UI.videoDom.videoLength;
        } else {
            length = Model.UI.audioDom.audioLength;
        }
        Model.UI.logoDom.value = "NO." + (i + 1) + "/" + length;
    }
    Model.showMediaNum(0);
    // 展示时间进度条
    Model.showTimeUI = function () {
        let content;
        if (Model.isVideo) {
            content = parseInt(Model.UI.videoDom.currentTime) + " s" + "/" + parseInt(Model.UI.videoDom.duration) + " s";
        } else {
            content = parseInt(Model.UI.audioDom.currentTime) + " s" + "/" + parseInt(Model.UI.audioDom.duration) + " s";
        }
        Model.UI.timeDom.value = content;
    };
    // 切换媒体类型的函数
    Model.switchMediaDom = function () {
        if (Model.isVideo) {
            Model.UI.stageDom.removeChild(Model.UI.videoDom);
            Model.UI.stageDom.appendChild(Model.UI.audioDom);
        } else {
            Model.UI.stageDom.removeChild(Model.UI.audioDom);
            Model.UI.stageDom.appendChild(Model.UI.videoDom);
        }
    };

    Model.createAudioMenu = function () {
        let pDom;
        let titles = mediaData.audioFiles[Model.i].titles;
        let time = mediaData.audioFiles[Model.i].time;
        for (let i = 0; i < titles.length; i++) {
            pDom = document.createElement("p");
            pDom.textContent = titles[i];
            pDom.onclick = function () {
                Model.removeAudioZimu();
                Model.UI.audioDom.currentTime = time[i][0];
                Model.UI.audioDom.play();
                Model.removeAudioZimu();
                Model.UI.addInfoToStage("成功读取知识点！" + (i + 1));
                window.setTimeout(function () {
                    Model.UI.audioDom.pause();
                }, (time[i][1] - time[i][0]) * 1000);
            };
            Model.UI.stageDom.appendChild(pDom);
        }
    };


    Model.removeAudioMenu = function () {
        let pDom = document.querySelectorAll("div#stage p");
        for (let i = 0; i < 6 && i < pDom.length; i++) {
            pDom[i].remove();
        }
    };
    Model.removeAudioZimu = function () {
        let h3Dom = document.querySelectorAll("div#zimu h3");
        for (let i = 0; i < h3Dom.length; i++) {
            if (h3Dom[i].parentNode === Model.UI.zimuDom) {
                Model.UI.zimuDom.removeChild(h3Dom[i]);
            }
        }
    };

    function setImg(el) {
        document.getElementById('img2').src = el.href;
        return false;
    }

    // Model
    Model.init = function () {
        Model.UI.videoDom.src = Model.UI.videoDom.getURL(0);
        Model.UI.audioDom.src = Model.UI.audioDom.getURL(0);
        Model.createWidth(0);
        // 第七次作业更新任务3— — — —实时视频时间

        //--- 以下都是异步代码
        // 第八次作业更新任务1.— — — —将实时播放视频时间放入div中
        window.setInterval(Model.showTimeUI, 1000);
        // 定义向前按钮

        Model.UI.preDom.onclick = function () {
            // 定义局部变量
            let i = Model.i;
            let length = null;
            let file = null;
            // 判断是视频文件还是音频文件
            if (Model.isVideo) {
                length = Model.UI.videoDom.videoLength;
                file = Model.UI.videoDom;
            } else {
                length = Model.UI.audioDom.audioLength;
                file = Model.UI.audioDom;

            }
            // 业务处理
            if (i == 0) {
                i = length - 1;
            } else {
                i--;
            }
            // 2.4 — — — —每次切换视频需要更新目录内容

            Model.showMediaNum(i);
            Model.i = i;
            file.src = file.getURL();			if (!Model.isVideo) {				Model.removeAudioMenu();
                Model.removeAudioZimu();
                Model.createAudioMenu();
            }
            file.play();
        }
        // 定义播放按钮
        Model.UI.playDom.onclick = function () {
            if (Model.isVideo) {
                Model.UI.videoDom.play();
            } else {
                Model.UI.audioDom.play();
            }
        };
        // 定义暂停按钮
        Model.UI.stopDom.onclick = function () {

            if (Model.isVideo) {
                Model.UI.videoDom.pause();
            } else {
                Model.UI.audioDom.pause();
            }
        }
        // 定义向后按钮
        Model.UI.nextDom.onclick = function () {
            // 定义局部变量
            let i = Model.i;
            let length = null;
            let file = null;
            // 判断是视频文件还是音频文件
            if (Model.isVideo) {
                length = Model.UI.videoDom.videoLength;
                file = Model.UI.videoDom;
            } else {
                length = Model.UI.audioDom.audioLength;
                file = Model.UI.audioDom;
            }
            // 业务处理
            if (i == length - 1) {
                i = 0;
            } else {
                i++;
            }
            // 2.4 — — — —每次切换视频需要更新目录内容

            Model.showMediaNum(i);
            Model.i = i;
            file.src = file.getURL();
            if (!Model.isVideo) {				Model.removeAudioMenu();
                Model.removeAudioZimu();
                Model.createAudioMenu();}
            file.play();
        };
        // 切换媒体
        Model.UI.switchDom.onclick = function () {
            Model.i = 0;
            if (Model.isVideo) {
                Model.UI.switchDom.value = "Video";
                Model.createAudioMenu();
            } else {
                Model.UI.switchDom.value = "Audio";
                Model.removeAudioMenu();
                Model.removeAudioZimu();

            };
            Model.switchMediaDom();
            Model.isVideo = !Model.isVideo;
            Model.showMediaNum(Model.i);
        };
        var header = document.getElementById("header");
        var header2 = document.getElementById("header2");
        mediaData.imgFiles.forEach(function(file, index) {
            var img = document.createElement("img");
            img.src = mediaData.imgPath + "/" + file.fileName[0];
            img.id = "img" + index + index;
            header.appendChild(img);
            var anchor = document.createElement("a");
            anchor.href = mediaData.imgPath + "/" + file.fileName[0];
            anchor.textContent = file.Name[0];
            anchor.onclick = function() {
                return setImg(this);
            };
            header2.getElementsByTagName("ul")[0].appendChild(anchor);
        });


        Model.UI.addInfoToStage = function (info) {
            const infoNum = 5;
            const zimuDom = document.querySelectorAll("#zimu h3");
            if (zimuDom.length >= infoNum) {
                zimuDom[0].parentNode.removeChild(zimuDom[0]);
            }
            const h3Dom = document.createElement("h3");
            h3Dom.style.fontSize = "initial";
            h3Dom.textContent = info;
            document.getElementById("zimu").appendChild(h3Dom);
            if (Model.UI.clockOfInfo === null) {
                Model.UI.clockOfInfo = setInterval(Model.UI.infoAnimation, 50);
            }
        };
        document.getElementById('logo').addEventListener('click', function () {
            this.value = '';  // Clear the input field on click
        });
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('logo').addEventListener('keyup', function (event) {
                if (event.keyCode === 13) {
                    let mediaIndex = parseInt(this.value);
                    if (mediaIndex >= 1 && mediaIndex <= (Model.isVideo ? Model.UI.videoDom.videoLength : Model.UI.audioDom.audioLength)) {
                        Model.i = mediaIndex - 1;
                        if (Model.isVideo) {
                            Model.UI.videoDom.src = Model.UI.videoDom.getURL();
                            Model.UI.videoDom.play();
                        } else {
                            Model.UI.audioDom.src = Model.UI.audioDom.getURL();
                            Model.UI.audioDom.play();
                        }
                        Model.showMediaNum(Model.i);
                    }
                }
            });
        });
    }
    Model.init();
</script>
</html>
